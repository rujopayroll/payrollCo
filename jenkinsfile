pipeline {
  agent any
  tools {nodejs "14.20.1"}

    environment 
    {
        AWS_ACCOUNT_ID=746662389335
        AWS_DEFAULT_REGION="us-east-1"
        IMAGE_REPO_NAME="payroll-app"
        IMAGE_TAG="latest"
        REPOSITORY_URI = "${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com/${IMAGE_REPO_NAME}"
        EXECUTION_ROLE_ARN = "arn:aws:iam::746662389335:role/iam-ECSTaskExecutionRole-OSWKTFM1Z7UT"
        CLUSTER = "PayrollCluster"
        SERVICE = "AppPayrollService"
    }

  stages {
    stage('INSTALL PACKAGES') {
      steps {
        sh "npm install"
      }
    }
    stage('TEST') {
      steps {
        echo "insert your testing here"
      }
    }
    stage('BUILD APP') {
      steps {
        sh 'ng build --configuration development'
        //sh "node_modules/.bin/ng build --configuration development"
      }
    }
    stage("BUILD DOCKER") {
      steps {
        script {
          dockerImageBuild = docker.build "testapp:latest"
        }
      }
    }
    
    stage("DEPLOY & ACTIVATE") {
      steps {
        echo 'this part will differ depending on setup'
      }
    }
  }
}